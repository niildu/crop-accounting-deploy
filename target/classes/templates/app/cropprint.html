<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	th:replace="~{fragments/layout :: layout (~{::body},'cropprint')}">
<body>
	<div class="wrapper-md" ng-app="myApp">
		<div class="row" ng-controller="dropdownCtrl">
				<div class="panel panel-default" id="printID">
					<div class="panel-heading font-bold" th:text="#{expenditure.estimate.all}">
					</div>
					<div class="form-actions">
						<a id="btnPrint" href="#">
							<img
							src="../../img/print/images.jpeg" alt="Print"
							style="margin-bottm: 15px; margin-left: 15px; margin-right: 15px; width: 40px;"
							onclick="printDiv('printcontent');">
						</a>
					</div>
					<div class="well clearFix"></div>
					<div class="panel-body">
						<div id="printcontent">
							<div>
								<style>
									body.print-page
									{
										-webkit-transform: scale(0.85);  /* Saf3.1+, Chrome */
							            -moz-transform: scale(0.85);  /* FF3.5+ */
									    -ms-transform: scale(0.85);  /* IE9 */
									    -o-transform: scale(0.85);  /* Opera 10.5+ */
									    transform: scale(0.85);
									    margin: -50px -73px 0;  /* big hack to reposition the page top the top and left of the viewer control */
									}
									table, tr, td { 
										border: 1px solid #000000;
										border: 1px solid #000000;
										border-style: solid;
										border-width: 0.009em;
										border-collapse: collapse;
										padding: 2px;
										text-align: center;
										font-size: 14px;
									}
									
									.h1-text {
										text-align: center;
										line-height: 15px;
										top: 4px;
									}
									
									.sp_text {
										font-size: 12px;
									}
									
									.sp_hedertext {
										font-size: 12px;
									}
									
									.code_div {
										width: 190px;
										height: 14px;
										float: left;
										margin-bottom: 4px;
									}
									
									.cove_sub_div_with_border {
										width: 12px;
										height: 12px;
										border-style: solid;
										border-width: 0.01em;
										float: left;
										margin: 1px;
										text-align: center;
										font-size: 10px;
										font-family: SolaimanLipi;
										padding: 1px;
										list-style-type: Bengali;
									}
									
									.cove_sub_div_without_border {
										width: 25px;
										height: 25px;
										float: left;
									}
									
									.name:after {
										clip: rect(0px, 190px, 20px, 0px);
										content: " ..................... ";
										position: absolute;
										z-index: -1;
									}
									
									.pageToPrint {
										width: 300px;
										height: 210px;
									}
									
									.doublePageEnd {
										margin-left: 340px;
										page-break-after: always;
									}
									
									.page_odd {
										margin-left: 320px;
										width: 300px;
										height: 210px;
										/*page-break-after: always;*/
									}
									
									.page_even {
										width: 300px;
										height: 210px;
										/*page-break-after: always;*/
									}
									
									/*@page {
										size: 9.5in 4.625in;
										page-break-after: always;
									}*/
									
									@page {
										/*size: 15cm 8cm;*/
										/*margin: 30mm 45mm 30mm 45mm;*/
										size: 9.5in 4.625in;
										page-break-after: always;
										-webkit-transform: scale(1.4);  /* Saf3.1+, Chrome */
							            -moz-transform: scale(1.4);  /* FF3.5+ */
									    -ms-transform: scale(1.4);  /* IE9 */
									    -o-transform: scale(1.4);  /* Opera 10.5+ */
									    transform: scale(1.4);
									    margin-top: 2cm;
									    margin-bottom: 2cm;
									    margin-left: 2cm;
									    margin-right: 2cm;
									    margin: 20px 20px 0;  /* big hack to reposition the page top the top and left of the viewer control */
									}
									
									@media print {
									    html, body {
									        height: 80%;
									    }
									    div{
									        background-color: #FFFFFF;
									    }
									}
									
									#printcontent {
										width: 692px;
										height: 292px;
										border: none;
										font-size: 14pt;
										font-family: SolaimanLipi;
										/* for firefox, safari, chrome, etc. */
										/*-webkit-transform: rotate(-90deg);  
													-moz-transform: rotate(-90deg);  
													*/
										/* for ie */
										filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=3);
									}
									
									@font-face {
										font-family: SolaimanLipi;
										src: url('../../fonts/SolaimanLipi.ttf');
									}
									
									body {
										font-family: SolaimanLipi
									}
								</style>
								<div data-ng-repeat="doublePage in bookletPages" ng-init="parentIndex = $index">
									<div data-ng-repeat="page in doublePage">
										<div ng-if="$parent.$index == 0 && $index == 0" class="doublePageEnd" style="margin-left: 350px; width: 300px; height: 210px;">
											<div style="width: 100%">
												<h5 class="h1-text" th:text="#{application.name}"></h5>
												<h6 class="h1-text">ফসল চাষের ব্যয়</h6>
												<div style="float: left">
													<span style="float: left; margin-right: 20px; margin-top: 0px;"
														class="sp_hedertext"> নামঃ </span> <span
														style="float: left; margin-top: 0px;" class="sp_hedertext" th:text="${crop.farmer.name}"></span>
													<br />
												</div>
												<div style="float: right">
												<span style="float: right; margin-right: 27px; margin-left: 10px; margin-top: 0px;" class="sp_hedertext" th:text="${crop.startDate}"></span>
												<span class="name sp_hedertext" style="float: right; margin-right: 10px; margin-top: 0px;">	তারিখঃ </span> 
												</div>
											</div>
											<br />
				
											<div style="width: 100%">
												<div style="float: left">
													<span style="float: left; margin-top: 0px;"
														class="sp_hedertext"> জাতীয় আইডি কার্ড নম্বরঃ </span>
												</div>
												<div class="">
													<div class="cove_sub_div_with_border" th:each="indexValue : ${#numbers.sequence(0, (crop.farmer.nid.length() - 1))}">
														<span th:text="${crop.farmer.nid.charAt(indexValue)}"></span>
													</div>
												</div>
											</div>
				
											<br><br> <span class="sp_text">নোটঃ </span>
											<span class="sp_text">১। সংশ্লিষ্ট দপ্তরের সহিত যোগাযোগ
												করিয়া সঠিক কোড নাম্বর জানিয়া লইবেন। </span> <br>
										</div>
										<div ng-class="$index % 2 == 0 ? 'pageToPrint pull-left':'pageToPrint doublePageEnd'">
											<table width="98%" style="margin: 3px;">
												<tr>
													<th style="font-size: 10px;" th:text="#{activity.name}"></th>
													<th style="font-size: 10px;" th:text="#{task.name}"></th>
													<th style="text-align: center; font-size: 10px;" th:text="#{task.desc}"></th>
													<th style="text-align: center; font-size: 10px;" th:text="#{task.date}"></th>
													<th style="text-align: center; font-size: 10px;" th:text="#{item.price}"></th>
													<th style="text-align: center; font-size: 10px;" th:text="#{actual.expence}"></th>
													<th style="text-align: center; font-size: 10px;" th:text="#{labour.price}"></th>
													<th style="text-align: center; font-size: 10px;" th:text="#{actual.expence}"></th>
												</tr>
												<!-- <div data-ng-repeat="item in page" style="width: 100%"> -->
													<tr data-ng-repeat="item in page.taskList">
														<td width="20%" style="font-size: 10px;">{{item.activityName}}</td>
														<td width="14%" style="font-size: 10px;">{{item.taskName}}</td>
														<td width="14%" style="font-size: 10px;">{{item.itemExpName}}</td>
														<td width="7%" style="font-size: 10px;">{{item.subtaskdate}}</td>
														<td width="11%" style="font-size: 10px;">{{item.itemExpence}}</td>
														<td width="11%" style="font-size: 10px;">&nbsp;</td>
														<td width="11%" style="font-size: 10px;">{{item.labourExpence}}</td>
														<td width="11%" style="font-size: 10px;">&nbsp;</td>
													</tr>
													<!-- end ngRepeat: item in page -->
													<tr>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
													</tr>
													<tr>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
														<td>&nbsp;</td>
													</tr>
											</table>
											<div class="row">
												<div class="col-sm-12">
													<div class="pull-left col-sm-9">
														<span class="sp_text pull-left">&nbsp;নোটঃ </span>
														<div style="margin-left: 40px;">
																<div class="row" data-ng-repeat="item in page.taskList">
																	<span class="sp_text">{{$index + 1}}| {{item.comment}}</span>
																</div>
														</div>
													</div>
													<div class="pull-left col-sm-3">
														<span>পৃষ্ঠা {{page.pageno}}</span><br>
													</div>
													
												</div>
											</div>
											
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			<!-- </div> -->
		</div>
	</div>
	<script type="text/javascript">
		var expenceItemList = new Array();
		var taskList = new Array();
		var pages = new Array();
		var printPage = {};
		//pages.push({});
		var j = 0;
	</script>
<div th:if="${cropExpenceList.isPresent() && cropExpenceList.get().expenceItemValueList != null 
											&& !cropExpenceList.get().expenceItemValueList.empty}">
								<div th:each="expenceItemValue, iter : ${cropExpenceList.get().expenceItemValueList}">
									<script type="text/javascript" th:inline="javascript">
									/*[+
										var cropUnit = [[${crop != null} ? ${crop.getCropUnit()} : 0]];
										var itemExpence = [[${expenceItemValue != null} ? ${expenceItemValue.getItemExpence()} : 0]];
										var labourExpence = [[${expenceItemValue != null} ? ${expenceItemValue.getLabourExpence()} : 0]];
										var landAmount = [[${crop != null} ? ${crop.getCropLandQuantity()}: 0]];
										var landUnitValue = [[${crop != null} ? ${T(com.cropaccounting.util.UnitEnum).getConversionRateById(crop.getCropUnit())} : 1 ]];
										var landUnit = Math.ceil(landAmount * landUnitValue);  
										var expenceOfItems = (itemExpence * landUnit);
										var expenceOfLabours = (labourExpence * landUnit);
										//console.log(itemExpence + ' ' + labourExpence + ' ' + landUnit);
										var data = {
											id : [[${expenceItemValue.getId()}]], 
											task : [[${expenceItemValue.getCropActivityType(expenceItemList) != null} ? ${expenceItemValue.getCropActivityType(expenceItemList).getId()} : '']], 
											subtask : [[${expenceItemValue.getCropCalenderTask() != null} ? ${expenceItemValue.getCropCalenderTask().getTaskName()} : '']],
											subtaskdate : [[${expenceItemValue.getCropCalenderTask() != null} ? ${expenceItemValue.getCropCalenderTask().getTaskDateStr()} : '']],
											activity : [[${expenceItemValue.getCropActivity(expenceItemList) != null} ? ${expenceItemValue.getCropActivity(expenceItemList).getId()} : '']],
											activityName : [[${expenceItemValue.getCropActivity(expenceItemList) != null} ? ${expenceItemValue.getCropActivity(expenceItemList).getName()} : '']], 
											taskName : [[${expenceItemValue.getCropActivityType(expenceItemList) != null} ? ${expenceItemValue.getCropActivityType(expenceItemList).getName()} : '']],
											
											itemExpence : expenceOfItems,
											itemExp : [[${expenceItemValue.getCropActivityItem() != null} ? ${expenceItemValue.getCropActivityItem().getId()} : '']],
											itemExpName : [[${expenceItemValue.getCropActivityItem() != null } ? ${expenceItemValue.getCropActivityItem().getName()} : '']],
											labourExpence : expenceOfLabours,
											comment : [[${expenceItemValue.cropCalenderTask.comments}]]
										};
										var pageData = {};
										if(j % 2 == 0) {
											if(taskList.length > 0) {
												pageData = {'pageno' : 0, 'taskList' : taskList};
												pages.push(pageData);
												//pages.push(taskList);												
											}
											taskList = [];
										}
										var size = [[${cropExpenceList.get().expenceItemValueList.size()}]];
										//console.log(size);
										taskList.push(data);
										
										if(j == (size - 1)) {
											pageData = {'pageno' : 0, 'taskList' : taskList};
											if(taskList.length > 0) pages.push(pageData);
											//if(taskList.length > 0) pages.push(taskList);
										}
										j++;
										
									+]*/
									</script>
								</div>
							</div>

	<script type="text/javascript">
	var a={1:"১",2:"২",3:"৩",4:"৪",5:"৫",6:"৬",7:"৭",8:"৮",9:"৯",0:"০"};
	var myApp = angular.module("myApp", []);
	//var taskList = [];
	//console.log(taskList);
	//console.log(pages);
	var cropActivityList = [];
	var cropActivityTypeList = [];
	//var expenceItemList = [];
	//var pages = [];
	console.log('pages.length:' + pages.length);
	var emptyPages = pages.length % 4;
	console.log('emptyPages:' + emptyPages);
	for(var i = 0; i < (4 - emptyPages); i++) {
		var pageData = {'pageno' : 0, 'taskList' : ''};
		pages.push(pageData);
		console.log('pages:'+pages.length);
	}
	var bookletPages = new Array();
	var pageNumber = Math.ceil(pages.length / 2);
	//console.log('pageNumber:' + pageNumber);
	var reverse = 0;
	var pageHalf = Math.round(pageNumber / 2);
	console.log('pageHalf::' + pageHalf + ' pageNumber::' + pageNumber);
	for(var i = pageHalf; i >= 0; i--) {
		//getPagesForBookLet(i, pageHalf, pages);
	}
	
	for(var i = Math.ceil(pages.length / 4); i > 0; i--) {
		console.log('i--' + i + ' reverse::' + reverse);
		var frontLeft = (i * 4 + (2 * reverse));
		var frontRight = ((2 * reverse)) + 1;
		var backLeft = ((2 * reverse)) + 2;
		var backRight = (i * 4 + (2 * reverse)) - 1;
		console.log('frontLeft:' + frontLeft 
				+ ' frontRight:' + frontRight 
				+ ' backLeft:' + backLeft 
				+ ' backRight:' + backRight);
		
		var item1 = pages[frontLeft - 1];
		var item2 = pages[frontRight - 1];
		var item3 = pages[backLeft - 1];
		var item4 = pages[backRight - 1];
		if (item1 != (undefined)) item1.pageno = ('' + frontLeft).replace(/\d/g,function(index){return a[index]});
		if (item2 !== (undefined)) item2.pageno = ('' + frontRight).replace(/\d/g,function(index){return a[index]});
		if (item3 != (undefined)) item3.pageno = ('' + backLeft).replace(/\d/g,function(index){return a[index]});
		if (item4 != (undefined)) item4.pageno = ('' + backRight).replace(/\d/g,function(index){return a[index]});
		
		bookletPages.push({item1, item2});
		bookletPages.push({item3, item4});
		reverse++;	
	}
	
	/* console.log('pageHalf::' + pageHalf + ' pageNumber::' + pageNumber);
	for(var i = pageNumber; i >= pageHalf; i--) {
		console.log('index--' + i)
		if (pageNumber > 1 && i == pageHalf) reverse = reverse + 1;
		var frontLeft = (i * 2);
		var frontRight = (reverse * 2) + 1;
		var backLeft = pageHalf == 1 ? 2 :(reverse * 2) + 2;
		var backRight = pageHalf == 1 ? 0 : (i * 2) - 1;
		console.log('frontLeft:' + ((frontLeft <= pages.length) ? frontLeft : 0) 
				+ ' frontRight:' + ((frontRight <= pages.length) ? frontRight : 0) 
				+ ' backLeft:' + ((backLeft <= pages.length) ? backLeft : 0) 
				+ ' backRight:' + ((backRight <= pages.length) ? backRight : 0));
		//console.log(pages[frontLeft - 1]);
		var item1 = pages[((frontLeft <= pages.length) ? frontLeft : 0) - 1];
		var item2 = pages[((frontRight <= pages.length) ? frontRight : 0) - 1];
		var item3 = pages[((backLeft <= pages.length) ? backLeft : 0) - 1];
		var item4 = pages[((backRight <= pages.length) ? backRight : 0) - 1];
		if (item1 != (undefined)) item1.pageno = ('' + frontLeft).replace(/\d/g,function(index){return a[index]});
		if (item2 !== (undefined)) item2.pageno = ('' + frontRight).replace(/\d/g,function(index){return a[index]});
		if (item3 != (undefined)) item3.pageno = ('' + backLeft).replace(/\d/g,function(index){return a[index]});
		if (item4 != (undefined)) item4.pageno = ('' + backRight).replace(/\d/g,function(index){return a[index]});
		
		bookletPages.push({item1, item2});
		bookletPages.push({item3, item4});
		reverse++;
	} */
	
	function getPagesForBookLet(iteration, maxIteration, pages) {
		//var bookletPages = [];
		iteration = iteration - 1;
		maxIteration = maxIteration - 1;
		var breakPoint = Math.ceil(maxIteration / 2);
		var frontLeft = iteration >= breakPoint ? ((iteration * 4) + 4) : (((maxIteration - iteration) * 4) + 2);
		var frontRight = iteration >= breakPoint ? (((maxIteration - iteration) * 4) + 1) : ((iteration * 4) + 3);
		var backLeft = iteration >= breakPoint ? (((maxIteration - iteration) * 4) + 2) : ((iteration * 4) + 4);
		var backRight = iteration >= breakPoint ? ((iteration * 4) + 3) : (((maxIteration - iteration) * 4) + 1);
		console.log('frontLeft::' + frontLeft
				+ ' frontRight::' + frontRight 
				+ ' backLeft::' + backLeft
				+ ' backRight::' + backRight);
		var item1 = fillUndefined(pages[frontLeft - 1], frontLeft);
		var item2 = fillUndefined(pages[frontRight - 1], frontRight);
		var item3 = fillUndefined(pages[backLeft - 1], backLeft);
		var item4 = fillUndefined(pages[backRight - 1], backRight);

		bookletPages.push({item1, item2});
		bookletPages.push({item3, item4});
	}
	
	function fillUndefined(item, pageNo) {
		if (item == (undefined))
			return {'pageno' : replaceBengali(pageNo), 'taskList' : ''};
		item.pageno = replaceBengali(pageNo);
		return item;
	}
	
	function replaceBengali(number) {
		return ('' + number).replace(/\d/g,function(index){return a[index]});
	}
	
	var reOrderBoolLet = bookletPages;
	//console.log(bookletPages);
	bookletPages = [];
	for(var i = 0; i < reOrderBoolLet.length/2; i++) {
		bookletPages.push();	
	}
	
	var booletMiddle = Math.ceil(reOrderBoolLet.length / 4);
	var reverse = Math.round(reOrderBoolLet.length / 4);
	for (var i = 0; i < Math.round(reOrderBoolLet.length / 4); i++) {
		bookletPages.push(reOrderBoolLet[i * 4]);
		bookletPages.push(reOrderBoolLet[(reverse * 4) - 1]);
		//console.log(reOrderBoolLet[i * 2] + reOrderBoolLet[(i * 2) - 1]);
		reverse--;
	}
	
	console.log(bookletPages);
	bookletPages = reOrderBoolLet;
	var i = 0;    
	myApp.factory("CustomerService", ['$filter', 
	      function($filter){
		    var service = {}; 
			service.getExpenceItemList = function(crop){
	            var expenceItemList = ($filter('filter')(expenceItemList, {crop_id: crop}));      
	            return expenceItemList;
	        };
	        return service;       
	    }]);
	    
	myApp.controller('dropdownCtrl', ['$scope','CustomerService', 
	   function($scope, CustomerService) {
			$scope.taskList = taskList;
			$scope.pages = pages;
			$scope.bookletPages = bookletPages;
			$scope.taskDtl ={
				id:'', name: '', date: '',activity:'',activityName :'',task:'',taskName:'',subtask:'',subtaskdate:'',itemExp:'',itemExpName:'',comments:'',itemExpence:'',labourExpence:''
			};
			$scope.getVarities = function(index){
	    }    
	}]);  
	
	function printDiv(divName) {
		
	    var printContents = document.getElementById(divName).innerHTML;
	    var originalContents = document.body.innerHTML;
		/* for printing in this page */
	    document.body.innerHTML = printContents;
	    window.print();
	    document.body.innerHTML = originalContents;
	    /* for printing in this page ends*/
	    
	    /*
		w=window.open();
	    var printContents = document.getElementById(divName).innerHTML;
	    console.log(printContents)
		w.document.write(printContents);
		w.print();
		w.close();
		*/
	}
	
	
	$(document).ready(function(){
	    var MaxHeight = 200;
	    var RunningHeight = 0;
	    var PageNo = 1;
	    /* $('table.splitForPrint > tbody > tr').each(function () {
	        if (RunningHeight + $(this).height() > MaxHeight) {
	            RunningHeight = 0;
	            PageNo += 1;
	        }
	        RunningHeight += $(this).height();
	        $(this).attr("data-page-no", PageNo);
	    });
	
	    for(i = 1; i <= PageNo; i++){
	        $('table.splitForPrint').parent().append("<div class='tablePage'><hr /><table id='Table" + i + "'><tbody></tbody></table><hr /></div>");
	        var rows = $('table tr[data-page-no="' + i + '"]');
	        $('#Table' + i).find("tbody").append(rows);
	    }
	    $('table.splitForPrint').remove(); */
	});
</script>
	<script>

function togglePageBreakAfter( ){
	 //Get a handle on all the DIV elements (IE5+,OP5+ only)
	 //divs = document.getElementsByTagName( arguments[0] );
	 console.log("togglePageBreakAfter is called");
	 var divs = [];
	 divs.push(document.getElementById( 'printID'));
	 var rows = [];
	 $('#printtable tr').each(function(){
		 rows.push(this);
	 });
	 //alert(rows.length);
	 var index = 0;
	 var headerTop = rows.pop();
	 var headerSecond = rows.pop();
	 //alert('headerTop::'+headerTop.innerHTML);
	 for (var i=0; i < rows.length; i++ ) {
		if(i % 4 == 0) {
			//alert('breaking page::::'+rows[i].innerHTML);
			rows[i].style.pageBreakAfter = (arguments[1]) ? "always":"";
		}
	 }
	 //alert(divs.length);
	 //Loop through all the DIVs
	 for (var i=0; i < divs.length; i++ ) {
	  div = divs[i];
	
	  //if the first argument is true turn breaks on
	  //otherwise, turn them off.
	  //div.style.pageBreakAfter = (arguments[1]) ? "always":"";
	 }
	
	 //if the second argument is true print it (IE5+ only).
	 if ( arguments[2] && false) window.print();
	 
	 var printContents = document.getElementById('printID').innerHTML;
     var originalContents = document.body.innerHTML;
     document.body.innerHTML = printContents;
     //if ( arguments[2] ) window.print();
     //document.body.innerHTML = originalContents;
}

</script>

</body>
</html>

